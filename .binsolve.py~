from __future__ import division

def binsolve(f, target, a, b, ftol=1e-6, xtol=1e-6):
    _abs = abs
    mlast = None
    av,bv = map(f, [a,b])
    while True:
        m = (a+b) / 2
        mv = f(m)
        if m==mlast or _abs(mv-target) < ftol or _abs(a-b) < xtol:
            return m
        if (av>target and mv>target) or (av<target and mv<target):
            a = m
            av = mv
        elif (bv>target and mv>target) or (bv<target and mv<target):
            b = m
            bv = mv
        else:
            raise ValueError('invalid range or non-monotonic function')
        mlast = m
